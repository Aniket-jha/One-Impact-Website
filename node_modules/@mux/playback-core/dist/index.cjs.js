"use strict";var ae=Object.create;var P=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var ue=(e,t)=>{for(var r in t)P(e,r,{get:t[r],enumerable:!0})},V=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of se(t))!de.call(e,o)&&o!==r&&P(e,o,{get:()=>t[o],enumerable:!(n=ie(t,o))||n.enumerable});return e};var k=(e,t,r)=>(r=e!=null?ae(ce(e)):{},V(t||!e||!e.__esModule?P(r,"default",{value:e,enumerable:!0}):r,e)),le=e=>V(P({},"__esModule",{value:!0}),e);var _e={};ue(_e,{AutoplayTypes:()=>v,ExtensionMimeTypeMap:()=>f,Hls:()=>T.default,MediaError:()=>u,MimeTypeShorthandMap:()=>L,PlaybackTypes:()=>A,StreamTypes:()=>x,addTextTrack:()=>H,allMediaTypes:()=>fe,generatePlayerInitTime:()=>ge,generateUUID:()=>R,getError:()=>Pe,getStreamTypeConfig:()=>ee,initialize:()=>ke,isKeyOf:()=>_,isMuxVideoSrc:()=>C,loadMedia:()=>re,mux:()=>b.default,removeTextTrack:()=>q,setupHls:()=>j,setupMux:()=>te,shorthandKeys:()=>pe,teardown:()=>Q,toMuxVideoURL:()=>Ee});module.exports=le(_e);var b=k(require("mux-embed")),T=k(require("hls.js"));var m=class extends Error{constructor(r,n=m.MEDIA_ERR_CUSTOM,o){var a;super(r);this.name="MediaError",this.code=n,this.fatal=o!=null?o:n>=m.MEDIA_ERR_NETWORK&&n<=m.MEDIA_ERR_ENCRYPTED,this.message||(this.message=(a=m.defaultMessages[this.code])!=null?a:"")}},u=m;u.MEDIA_ERR_ABORTED=1,u.MEDIA_ERR_NETWORK=2,u.MEDIA_ERR_DECODE=3,u.MEDIA_ERR_SRC_NOT_SUPPORTED=4,u.MEDIA_ERR_ENCRYPTED=5,u.MEDIA_ERR_CUSTOM=100,u.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var S=k(require("hls.js"));var _=(e,t)=>e in t,v={ANY:"any",MUTED:"muted"},x={VOD:"on-demand",ON_DEMAND:"on-demand",LIVE:"live",LL_LIVE:"ll-live",DVR:"live:dvr",LL_DVR:"ll-live:dvr"},A={MSE:"mse",NATIVE:"native"},f={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},L={HLS:f.M3U8},pe=Object.keys(L),fe=[...Object.values(f),"hls","HLS"];var M=(e,t,r,n)=>{e.addEventListener(t,r,n),e.addEventListener("teardown",()=>{e.removeEventListener(t,r)},{once:!0})};function N(e,t,r){t&&r>t&&(r=t);for(let n=0;n<e.length;n++)if(e.start(n)<=r&&e.end(n)>=r)return!0;return!1}var U=e=>{let t=e.indexOf("?");if(t<0)return[e];let r=e.slice(0,t),n=e.slice(t);return[r,n]},h=e=>{let t=e.type;if(t){let n=t.toUpperCase();return _(n,L)?L[n]:t}let{src:r}=e;return r?ye(r):""},ye=e=>{let t="";try{t=new URL(e).pathname}catch{console.error("invalid url")}let r=t.lastIndexOf(".");if(r<0)return"";let o=t.slice(r+1).toUpperCase();return _(o,f)?f[o]:""};var Te=Object.values(v),K=e=>typeof e=="boolean"||typeof e=="string"&&Te.includes(e),B=({autoplay:e},t,r)=>{if(!t)return()=>{};let n=!1,o=!1,a=K(e)?e:!!e,s=()=>{n||M(t,"playing",()=>{n=!0},{once:!0})};if(s(),M(t,"loadstart",()=>{n=!1,s(),D(t,a)},{once:!0}),M(t,"loadstart",()=>{r||(o=!Number.isFinite(t.duration)),D(t,a)},{once:!0}),r&&r.once(S.default.Events.LEVEL_LOADED,(c,d)=>{var l;o=(l=d.details.live)!=null?l:!1}),!a){let c=()=>{!o||(r!=null&&r.liveSyncPosition?t.currentTime=r.liveSyncPosition:Number.isFinite(t.seekable.end(0))&&(t.currentTime=t.seekable.end(0)))};r&&M(t,"play",()=>{t.preload==="metadata"?r.once(S.default.Events.LEVEL_UPDATED,c):c()},{once:!0})}return c=>{n||(a=K(c)?c:!!c,D(t,a))}},D=(e,t)=>{if(!t)return;let r=e.muted,n=()=>e.muted=r;switch(t){case v.ANY:e.play().catch(()=>{e.muted=!0,e.play().catch(n)});break;case v.MUTED:e.muted=!0,e.play().catch(n);break;default:e.play().catch(()=>{});break}};var F=({preload:e,src:t},r,n)=>{if(!r)return()=>{};let o=p=>{p!=null&&["","none","metadata","auto"].includes(p)?r.setAttribute("preload",p):r.removeAttribute("preload")};if(!n)return o(e),o;let a=!1,s=!1,i=n.config.maxBufferLength,c=n.config.maxBufferSize,d=p=>{o(p);let y=p!=null?p:r.preload;s||y==="none"||(y==="metadata"?(n.config.maxBufferLength=1,n.config.maxBufferSize=1):(n.config.maxBufferLength=i,n.config.maxBufferSize=c),l())},l=()=>{!a&&t&&(a=!0,n.loadSource(t))};return M(r,"play",()=>{s=!0,n.config.maxBufferLength=i,n.config.maxBufferSize=c,l()},{once:!0}),d(e),d};var g=k(require("hls.js"));function W(e,t){t.on(g.default.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(o,{tracks:a})=>{a.forEach(s=>{var d;let i=(d=s.subtitleTrack)!=null?d:s.closedCaptions,c=t.subtitleTracks.findIndex(({lang:l,name:p,type:y})=>l==(i==null?void 0:i.lang)&&p===s.label&&y.toLowerCase()===s.kind);H(e,s.kind,s.label,i==null?void 0:i.lang,`${s.kind}${c}`)})});let r=()=>{var s;if(!t.subtitleTracks.length)return;let o=Array.from(e.textTracks).find(i=>i.id&&i.mode==="showing"&&["subtitles","captions"].includes(i.kind)),a=`${(s=t.subtitleTracks[t.subtitleTrack])==null?void 0:s.type.toLowerCase()}${t.subtitleTrack}`;if(o&&(t.subtitleTrack<0||(o==null?void 0:o.id)!==a)){let i=t.subtitleTracks.findIndex(({lang:c,name:d,type:l})=>c==o.language&&d===o.label&&l.toLowerCase()===o.kind);t.subtitleTrack=i}o&&(o==null?void 0:o.id)===a&&o.cues&&Array.from(o.cues).forEach(i=>{o.addCue(i)})};e.textTracks.addEventListener("change",r),t.on(g.default.Events.CUES_PARSED,(o,{track:a,cues:s})=>{let i=e.textTracks.getTrackById(a);if(!i)return;let c=i.mode==="disabled";c&&(i.mode="hidden"),s.forEach(d=>{var l;(l=i.cues)!=null&&l.getCueById(d.id)||i.addCue(d)}),c&&(i.mode="disabled")}),t.once(g.default.Events.DESTROYING,()=>{e.textTracks.removeEventListener("change",r),e.querySelectorAll("track[data-removeondestroy]").forEach(a=>{a.remove()})});let n=()=>{Array.from(e.textTracks).forEach(o=>{var a,s;if(!["subtitles","caption"].includes(o.kind)&&o.label==="thumbnails"){if(!((a=o.cues)!=null&&a.length)){let i=e.querySelector('track[label="thumbnails"]'),c=(s=i==null?void 0:i.getAttribute("src"))!=null?s:"";i==null||i.removeAttribute("src"),setTimeout(()=>{i==null||i.setAttribute("src",c)},0)}o.mode!=="hidden"&&(o.mode="hidden")}})};t.once(g.default.Events.MANIFEST_LOADED,n),t.once(g.default.Events.MEDIA_ATTACHED,n)}function H(e,t,r,n,o){let a=document.createElement("track");return a.kind=t,a.label=r,n&&(a.srclang=n),o&&(a.id=o),a.track.mode="disabled",a.setAttribute("data-removeondestroy",""),e.append(a),a.track}function q(e,t){let r=Array.prototype.find.call(e.querySelectorAll("track"),n=>n.track===t);r==null||r.remove()}var z,Y,Me=(Y=(z=globalThis==null?void 0:globalThis.navigator)==null?void 0:z.userAgent)!=null?Y:"",me=Me.toLowerCase().indexOf("android")!==-1,E=new WeakMap,G="mux.com",$,X,J=(X=($=T.default).isSupported)==null?void 0:X.call($),xe=me,ge=()=>b.default.utils.now(),R=b.default.utils.generateUUID,Ee=(e,{domain:t=G}={})=>{if(!e)return;let[r,n=""]=U(e);return`https://stream.${t}/${r}.m3u8${n}`},ve=e=>{if(!e)return;let[t]=e.split("?");return t||void 0},Le=e=>{if(!e||!e.startsWith("https://stream."))return;let[t]=new URL(e).pathname.slice(1).split(".m3u8");return t||void 0},be=e=>{var t,r,n;return(t=e==null?void 0:e.metadata)!=null&&t.video_id?e.metadata.video_id:C(e)&&(n=(r=ve(e.playbackId))!=null?r:Le(e.src))!=null?n:R()},Pe=e=>{var t;return(t=E.get(e))==null?void 0:t.error},ke=(e,t,r)=>{Q(t,r);let{metadata:n={}}=e,{view_session_id:o=R()}=n,a=be(e);n.view_session_id=o,n.video_id=a,e.metadata=n,E.set(t,{});let s=j(e,t);te(e,t,s),re(e,t,s);let i=B(e,t,s),c=F(e,t,s);return{engine:s,setAutoplay:i,setPreload:c}},Q=(e,t)=>{let r=t==null?void 0:t.engine;r&&(r.detachMedia(),r.destroy()),(e==null?void 0:e.mux)&&!e.mux.deleted&&(e.mux.destroy(),delete e.mux),e&&(e.removeAttribute("src"),e.load(),e.removeEventListener("error",oe),e.removeEventListener("error",w),e.removeEventListener("durationchange",ne),E.delete(e),e.dispatchEvent(new Event("teardown")))};function Z(e,t){var d;let r=h(e);if(!(r===f.M3U8))return!0;let o=!r||((d=t==null?void 0:t.canPlayType(r))!=null?d:!0),{preferPlayback:a}=e,s=a===A.MSE,i=a===A.NATIVE;return o&&(i||!(J&&(s||xe)))}var j=(e,t)=>{let{debug:r,streamType:n,startTime:o=-1,metadata:a,experimentalCmcd:s}=e,c=h(e)===f.M3U8,d=Z(e,t);if(c&&!d&&J){let l={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0},p=ee(n),y=s?{useHeaders:!0,sessionId:a.view_session_id,contentId:a.video_id}:void 0;return new T.default({debug:r,startPosition:o,cmcd:y,...l,...p})}},ee=e=>[x.LIVE,x.DVR].includes(e)?{backBufferLength:8}:[x.LL_LIVE,x.LL_DVR].includes(e)?{backBufferLength:4,maxFragLookUpTolerance:.001}:{},C=({playbackId:e,src:t,customDomain:r})=>{if(e)return!0;if(typeof t!="string")return!1;let n=window==null?void 0:window.location.href,o=new URL(t,n).hostname.toLocaleLowerCase();return o.includes(G)||!!r&&o.includes(r.toLocaleLowerCase())},te=(e,t,r)=>{var a;let{envKey:n}=e,o=C(e);if((n||o)&&t){let{playerInitTime:s,playerSoftwareName:i,playerSoftwareVersion:c,beaconCollectionDomain:d,debug:l,disableCookies:p}=e,y={...e.metadata,video_title:((a=e==null?void 0:e.metadata)==null?void 0:a.video_title)||void 0},O=I=>typeof I.player_error_code=="string"?!1:typeof e.errorTranslator=="function"?e.errorTranslator(I):I;b.default.monitor(t,{debug:l,beaconCollectionDomain:d,hlsjs:r,Hls:r?T.default:void 0,automaticErrorTracking:!1,errorTranslator:O,disableCookies:p,data:{...n?{env_key:n}:{},player_software_name:i,player_software:i,player_software_version:c,player_init_time:s,...y}})}},re=(e,t,r)=>{var a;if(!t){console.warn("attempting to load media before mediaEl exists");return}let n=Z(e,t),{src:o}=e;t&&n?(typeof o=="string"?(t.setAttribute("src",o),e.startTime&&(((a=E.get(t))!=null?a:{}).startTime=e.startTime,t.addEventListener("durationchange",ne,{once:!0}))):t.removeAttribute("src"),t.addEventListener("error",oe),t.addEventListener("error",w)):r&&o?(r.on(T.default.Events.ERROR,(s,i)=>{let c={[T.default.ErrorTypes.NETWORK_ERROR]:u.MEDIA_ERR_NETWORK,[T.default.ErrorTypes.MEDIA_ERROR]:u.MEDIA_ERR_DECODE},d=new u("",c[i.type]);d.fatal=i.fatal,d.data=i,t.dispatchEvent(new CustomEvent("error",{detail:d}))}),t.addEventListener("error",w),W(t,r),r.attachMedia(t)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function ne(e){var n;let t=e.target,r=(n=E.get(t))==null?void 0:n.startTime;if(!!r&&N(t.seekable,t.duration,r)){let o=t.preload==="auto";o&&(t.preload="none"),t.currentTime=r,o&&(t.preload="auto")}}async function oe(e){if(!e.isTrusted)return;e.stopImmediatePropagation();let t=e.target;if(!(t!=null&&t.error))return;let{message:r,code:n}=t.error,o=new u(r,n);if(t.src&&(n!==u.MEDIA_ERR_DECODE||n!==void 0))try{let{status:a}=await fetch(t.src);o.data={response:{code:a}}}catch{}t.dispatchEvent(new CustomEvent("error",{detail:o}))}function w(e){var n,o;if(!(e instanceof CustomEvent)||!(e.detail instanceof u))return;let t=e.target,r=e.detail;!r||!r.fatal||(((n=E.get(t))!=null?n:{}).error=r,(o=t.mux)==null||o.emit("error",{player_error_code:r.code,player_error_message:r.message}))}
//# sourceMappingURL=index.cjs.js.map
